<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Quản Trị Nhân Viên</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="./config.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 p-6">
    <div class="max-w-2xl mx-auto bg-white p-6 rounded-xl shadow-lg">
        <h2 class="text-xl font-bold mb-6">Phê Duyệt Nhân Viên</h2>
        <div id="user-list" class="space-y-4">
            </div>
    </div>

    <script>
        const supabaseClient = supabase.createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON_KEY);

        async function loadUsers() {
            const { data } = await supabaseClient.from('user_permissions').select('*').order('role');
            document.getElementById('user-list').innerHTML = data.map(u => `
                <div class="flex justify-between items-center p-4 border rounded">
                    <div>
                        <p class="font-bold">${u.email}</p>
                        <p class="text-xs text-gray-500">Quyền hiện tại: <span class="uppercase">${u.role}</span></p>
                    </div>
                    ${u.role === 'pending' ? 
                        `<button onclick="approve('${u.email}')" class="bg-blue-600 text-white px-4 py-1 rounded text-xs">APPROVE</button>` : 
                        `<span class="text-green-600 text-xs font-bold">ĐÃ DUYỆT</span>`
                    }
                </div>
            `).join('');
        }

        async function approve(email) {
            await supabaseClient.from('user_permissions').update({ role: 'staff' }).eq('email', email);
            alert("Đã duyệt " + email);
            loadUsers();
        }

        loadUsers();
    </script>
</body>
</html>
